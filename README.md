# 80년대 마트 카운터 결제 미니게임 (개발용 README)

> 컨셉: 80년대 마트 계산대에서 **바코드 스캔 → 봉투 담기 → 계산 완료**를 제한시간(손님 만족도) 안에 정확히 수행하는 2D 타임어택 피지컬 미니게임  
> 목표: **공수는 간소화**하면서도 **재도전(리트라이)이 재밌는 구조**를 만든다.

---

## 1. 목표 / 승패 조건

### 목표
- 손님의 **만족도 게이지가 0이 되기 전에** 결제를 **정확히 완료**한다.

### 성공 조건
- `계산(결제) 버튼` 클릭 시,
  - 스캔된 상품 목록(수량/할인 규칙 포함)이 **정답과 일치**하면 성공
  - 다음 손님(또는 다음 라운드)로 진행

### 오답(실패) 처리
- `계산 버튼` 결과가 틀리면:
  - **만족도 감소**
  - 게임은 종료되지 않고 **계속 결제를 이어서 수정 가능**
- 만족도 게이지가 0이 되면:
  - 해당 손님 실패(게임오버 또는 라운드 실패)

---

## 2. 화면 구성 (UI 레이아웃)

### 상단: 손님 대기 영역
- 손님 캐릭터(대기 애니메이션/스프라이트)
- 손님 머리 위에 `만족도 게이지`
  - 시간 경과에 따라 지속 감소
  - 계산 오류 시 추가 감소(표정/효과)

### 중앙: POS / 스캔 중심 영역
- 중앙에 `POS 화면`
  - **스캔된 항목만** 리스트업
  - 각 항목에 `+ / - 버튼` 제공(수량 수정)
- POS 아래에 `바코드 스캔 영역`
  - 물건 바코드를 스캐너 위에 올려 스캔
  - **홀드(누적) 게이지** 표시 (대기 스트레스 완화)

### 좌/우: 아이템 보관 영역 2개
- **우측: 장바구니**
- **좌측: 비밀 봉투(담는 곳)**

---

## 3. 핵심 조작 흐름

1) 유저는 **우측 장바구니**에서 물건을 하나 선택(클릭)  
2) 선택된 물건이 **화면 중앙 스캔 영역 좌/우 측 위치**로 이동  
3) 유저는 물건 스프라이트 위의 **바코드 위치를 찾아** 스캔 영역(스캐너)에 올림  
4) 스캐너 위에 바코드가 올라가면 **홀드 게이지가 누적**되고, 완주하면 스캔 성공  
5) 스캔 후 해당 물건을 **좌측 비밀 봉투 영역**으로 이동  
6) POS 리스트에 스캔 결과가 누적되고, 필요하면 수량 수정 후 `계산 버튼`으로 정답 체크

> 이동 규칙(요구사항 반영)  
- 유저가 **장바구니 또는 비밀봉투에서 물건을 클릭**하면 해당 물건이 **중앙 스캔 영역의 좌/우**로 위치한다.

---

## 4. 스캔 시스템(피지컬 재미 핵심)

### 스캔 판정(권장: 누적 홀드)
- 바코드가 스캐너 영역 안에 들어오면 `holdProgress` 증가
- 영역 밖으로 나가면 `holdProgress`가 **서서히 감소** (완전 초기화 X)
- `holdProgress >= threshold`면 스캔 성공

> 목적: “1초 정지 대기”가 아니라 **컨트롤로 완주**하는 손맛을 만든다.

### 권장 파라미터(초안)
- `holdThreshold`: 0.4s (기본)
- `gainRate`: +1.0 / sec (영역 내)
- `decayRate`: -0.7 / sec (영역 밖)
- (옵션) 흔들림 허용: 영역 내에서는 위치가 약간 흔들려도 누적 유지

---

## 5. 상품(아이템) 데이터/스프라이트 규칙

### 기본 상품
- 2D 스프라이트 이미지
- 각 상품은 **기본 바코드 위치가 고정**
  - (x, y, w, h) 형태의 바코드 히트박스/영역 정의

### 할인 스티커 상품 (복수 바코드)
- 어떤 상품은 **추가 할인 바코드 스티커**가 붙어있을 수 있음
- 이런 상품은 **바코드가 여러 개 존재** 가능

#### 정답 처리 규칙(중요)
- 할인 바코드가 여러 개인 경우, **가장 낮은 할인율 바코드**를 찍어야 손님이 정상 인증(정답 인정)
- 다른 할인율 바코드를 찍으면 오답/인증 실패로 간주

#### 억울함 방지(공수 낮은 UX)
- 할인 스티커 바코드에 **할인율 숫자/문양/테두리** 등으로 구분 요소를 넣는다.
- 오답 시 안내 문구 1줄(예): `“승인 스티커(최저 할인율)만 유효!”`

---

## 6. 중복 상품 / 수량 처리

### 스캔 처리
- **동일 상품(중복)**의 경우:
  - 바코드 **첫 1회 스캔**로 상품 등록
  - 이후 동일 바코드를 또 스캔하면:
    - 해당 상품의 **수량 카운터 증가**
- POS 리스트에서:
  - `+ 버튼` 클릭으로 수량 증가
  - `- 버튼` 클릭으로 수량 감소(0 처리 정책은 구현 선택)

---

## 7. POS 표시 규칙

- **모든 물건의 가격을 미리 표시하지 않는다**
- POS에는 **스캔된 물건만** 표시
- 각 항목에:
  - 상품 이름/아이콘(스프라이트 썸네일)
  - 수량
  - `+ / -` 버튼
- 화면 하단(또는 POS 하단)에:
  - `계산(결제) 버튼` 존재

---

## 8. 계산(정답 체크) 로직 + 오답 피드백(공수 최소)

### 정답 데이터
- 손님(라운드)마다 정답 장바구니 구성이 존재
  - 상품 ID
  - 수량
  - (할인 상품이면) “정답 바코드(최저 할인율)” 조건 포함

### 유저 제출
- `계산 버튼` 클릭 시:
  - 정답이면 성공
  - 오답이면 만족도 감소 + 계속 수정 가능

### 오답 이유 분류(권장: 3종만)
오답 시 **납득 가능한 메시지** 1줄 출력 (UI 텍스트만으로 구현 가능)
- `누락`: “물건이 빠졌어요!”
- `수량`: “수량이 맞지 않아요!”
- `할인`: “할인 스티커가 달라요!”

> 목적: 오답이 ‘함정’이 아니라 **내 실수**로 느껴지게 만들어 재도전이 즐거워진다.

---

## 9. 만족도(타이머) 시스템 + 미세 회복(재미 강화, 공수 낮음)

### 감소 규칙
- 만족도는 0~100(예시) 범위
- 시간 경과로 일정 속도로 감소
- `계산 오답` 시 즉시 추가 감소

### “미세 회복” 보상(권장)
- **정확 스캔(첫 시도 성공)**: 만족도 +2 (소폭 회복)
- **봉투 담기 완료**: 만족도 +1 (소폭 회복)
- (선택) 콤보 유지 구간마다 +1

> 목적: 타임어택 피로를 줄이고 “잘하면 버틴다” 느낌을 준다.

### 오답 페널티(권장 밸런스)
- 단순히 “항상 대폭 감소”는 피로/억울함을 만들 수 있음
- 권장 옵션(둘 중 하나만 구현해도 효과 큼):
  1) **단계형 분노(3단계)**: 실수할수록 감소량 증가(연출 포함)
  2) **연속 실수 페널티**: 같은 라운드에서 오답이 누적될수록 감소량 증가

---

## 10. 점수/콤보(재도전 엔진, 공수 최소)

### 점수 목표
- 한 판 클리어뿐 아니라, **더 높은 점수/콤보**를 노리게 만들어 재도전 욕구를 만든다.

### 콤보 룰(권장)
- 스캔 성공 시 `combo +1`
- 아래 중 하나 발생 시 콤보 리셋:
  - 계산 오답
  - 스캔 실패(바코드가 스캐너에서 너무 오래 이탈)
  - (선택) 시간 초과/만족도 급락 이벤트

### 점수 룰(예시, 간단)
- 기본 스캔 성공: +100
- 첫 시도 정확 스캔 보너스: +50
- 콤보 보너스: `+20 * combo`
- 계산 정답 보너스: +300
- 남은 만족도 타임 보너스: `+ (남은 만족도 * 5)`
- 오답 감점: -200

> 구현 포인트: 점수/콤보는 **텍스트 UI + 숫자만**으로도 재도전 재미가 크게 상승한다.

---

## 11. 변주(반복 플레이 지루함 방지, 데이터 기반)

### 손님 성격 3종(아트 추가 없이 파라미터만)
- **급한 손님**: 만족도 감소 빠름 / 오답 페널티는 약함
- **까다로운 손님**: 만족도 감소 느림 / 오답 페널티 큼
- **관대한 손님**: 중간 / 점수 보너스 낮음(또는 타임 보너스 낮음)

### “오늘의 규칙” 1개 랜덤(선택)
라운드 시작 시 한 줄로 표시(공수 낮음)
- 예:
  - “오늘은 스캔이 20% 빠르다”
  - “오늘은 오답 1회 면책”
  - “오늘은 봉투 담기 보상 +2”
> 매판 하나만 적용해도 반복감이 줄고, 재도전 동기가 생김.

---

## 12. 상태 머신(권장)

- `Idle` : 대기(아이템 선택 전)
- `ItemSelected` : 중앙로 이동, 스캔 가능
- `Scanning` : 홀드 게이지 진행
- `Scanned` : POS 반영 + 스캔 완료 피드백
- `Bagging` : 비밀 봉투로 이동 처리
- `CheckoutAttempt` : 계산 버튼 클릭 후 정답 체크
- `Success` / `Mistake` / `Fail(Timeout)` : 결과 상태

---

## 13. 구현 체크리스트(업데이트)

- [ ] UI 레이아웃(상단 손님/중앙 POS+스캔/좌 봉투/우 장바구니)
- [ ] 만족도 게이지 시간 감소 + 오답 페널티(단계형/연속형 중 1개)
- [ ] 만족도 미세 회복(정확 스캔/봉투 담기)
- [ ] 아이템 클릭 시 중앙 영역 좌/우로 이동
- [ ] 바코드 히트박스/검출 및 **홀드 누적 스캔**
- [ ] 할인 스티커 상품(복수 바코드) + “최저 할인율만 정답” 룰
- [ ] 할인 오답 메시지 1줄(억울함 방지)
- [ ] 중복 상품 스캔 시 수량 증가 + POS에서 +/-
- [ ] POS 리스트: 스캔된 것만 표시
- [ ] 계산 버튼: 정답 통과 / 오답 시 이유 메시지(누락/수량/할인)
- [ ] 점수/콤보 표시 + 간단 점수 룰
- [ ] 손님 성격 3종(파라미터 테이블)

---

## 14. 데이터 포맷 예시(권장)

- `Item`
  - `id`
  - `name`
  - `sprite`
  - `barcodes[]`
    - `type` : normal | discount
    - `discountRate` : 0.05 / 0.10 ... (discount일 때)
    - `rect` : 바코드 위치(스프라이트 좌표계)

- `CustomerOrder`
  - `requiredItems[]`
    - `itemId`
    - `qty`
    - `requiredBarcodeRule` (할인 상품이면 “minDiscountOnly”)

- `CustomerProfile` (성격)
  - `satisfactionDrainPerSec`
  - `mistakePenalty`
  - `scoreMultiplier` (선택)

- `DailyRule` (선택)
  - `scanThresholdMultiplier`
  - `mistakeForgivenessCount`
  - `baggingBonus`

---

## 15. 참고 UX(아트 없이도 가능)

- 스캔 성공: “삑” 사운드 + 짧은 플래시 + 홀드 게이지 완주 이펙트
- 콤보 유지: `COMBO xN` 텍스트 팝업
- 오답: 손님 표정 변화 + “오답 이유 1줄” 표시
- 만족도 낮아질수록 손님 초조 연출(발 구르기, 팔짱 등)

---
