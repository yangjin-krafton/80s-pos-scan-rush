# 80년대 마트 카운터 결제 미니게임

> 컨셉: 80년대 마트 계산대에서 **바코드 스캔 → 봉투 담기 → 계산 완료**를 제한시간(손님 만족도) 안에 정확히 수행하는 2D 미니게임

---

## 1. 목표 / 승패 조건

### 목표
- 손님의 **만족도 게이지가 0이 되기 전에** 결제를 **정확히 완료**한다.

### 성공 조건
- `계산(결제) 버튼`을 눌렀을 때:
  - 스캔된 상품 목록(및 수량/할인 적용)이 **정답과 일치**하면 성공 처리
  - 다음 손님(또는 다음 라운드)로 진행

### 실패/페널티
- `계산 버튼` 결과가 틀리면:
  - **손님 만족도 게이지가 대폭 감소**
  - 게임은 종료되지 않고 **계속 결제를 이어서** 수정 가능
- 만족도 게이지가 0이 되면:
  - 해당 손님 실패(게임오버 또는 라운드 실패)

---

## 2. 화면 구성 (UI 레이아웃)

### 상단: 손님 대기 영역
- 손님 캐릭터(대기 애니메이션/스프라이트)
- 손님 머리 위에 `만족도 게이지`
  - 시간 경과에 따라 지속 감소
  - 계산 오류 시 추가 대폭 감소

### 중앙: POS / 스캔 중심 영역
- 중앙 상단/중앙에 `계산 카운터(POS 기기) 화면`
  - 스캔된 항목만 리스트업
  - 각 항목에 `+ / - 버튼` 제공
- POS 아래에 `바코드 스캔 영역`
  - 물건을 스캔 영역으로 이동시키고, **바코드가 스캐너 위에 1초간 머무르면 스캔 성공**

### 좌/우: 아이템 보관 영역 2개
- **우측: 장바구니**
- **좌측: 비밀 봉투(담는 곳)**

---

## 3. 핵심 조작 흐름

1) 유저는 **우측 장바구니**에서 물건을 하나 선택(클릭)  
2) 선택된 물건이 **화면 중앙 스캔 영역 좌/우 측 위치**로 이동(연출 포함)  
3) 유저는 물건 스프라이트 위의 **바코드 위치를 찾아** 스캔 영역(스캐너)에 올림  
4) **바코드가 스캐너 위에서 1초 유지**되면 스캔됨(사운드/이펙트)  
5) 스캔 후 해당 물건을 **좌측 비밀 봉투 영역**으로 이동(클릭/드래그 방식은 구현 선택)  
6) POS 리스트에 스캔 결과가 누적되고, 필요하면 수량 수정 후 `계산 버튼`으로 정답 체크

> 이동 규칙(요구사항 반영)  
- 유저가 **장바구니 또는 비밀봉투에서 물건을 클릭**하면 해당 물건이 **중앙 스캔 영역의 좌/우**로 위치한다.

---

## 4. 상품(아이템) 데이터/스프라이트 규칙

### 기본 상품
- 2D 스프라이트 이미지
- 각 상품은 **기본 바코드 위치가 고정**
  - 예: (x, y, w, h) 형태의 바코드 히트박스/영역 정의

### 할인 스티커 상품 (복수 바코드)
- 어떤 상품은 **추가 할인 바코드 스티커**가 붙어있을 수 있음
- 이런 상품은 **바코드가 여러 개 존재** 가능
- **정답 처리 규칙(중요):**
  - 할인 바코드가 여러 개인 경우, **가장 낮은 할인율 바코드**를 찍어야 손님이 정상 인증(정답 인정)
  - 다른 할인율 바코드를 찍으면 오답으로 간주(또는 “인증 실패” 상태로 계산 불가/오류 처리)

---

## 5. 중복 상품 / 수량 처리

### 스캔 처리
- **동일 상품(중복)**의 경우:
  - 바코드 **첫 1회 스캔**로 상품 등록
  - 이후 동일 바코드를 또 스캔하면:
    - 해당 상품의 **수량 카운터 증가**
- 또는 POS 리스트에서:
  - `+ 버튼` 클릭으로 수량을 즉시 증가
  - `- 버튼` 클릭으로 수량 감소(0이면 항목 제거 또는 0 유지 정책 선택)

---

## 6. POS 표시 규칙

- **모든 물건의 가격을 미리 표시하지 않는다**
- POS에는 **“스캔된 물건만”** 리스트업
- 각 항목에:
  - 상품 이름/아이콘(스프라이트 썸네일)
  - 수량
  - `+ / -` 버튼
- 화면 하단(또는 POS 하단)에:
  - `계산(결제) 버튼` 존재

---

## 7. 계산(정답 체크) 로직

### 정답 데이터
- 손님(라운드)마다 정답 장바구니 구성이 존재
  - 상품 ID
  - 수량
  - (할인 상품이면) “정답 바코드(최저 할인율)” 조건 포함

### 유저 제출
- 유저가 `계산 버튼` 클릭 시:
  - 스캔된 상품 목록 + 수량 + 할인 바코드 조건이 정답과 일치하면 성공
  - 하나라도 틀리면 오답:
    - 손님 만족도 게이지 대폭 감소
    - 계속 수정 가능(게임 지속)

---

## 8. 만족도(타이머) 시스템

### 감소 규칙
- 만족도는 0~100(예시) 범위
- 시간 경과로 일정 속도로 감소
- `계산 오답` 시 즉시 큰 폭으로 감소

### 종료 규칙
- 만족도 0 도달 시 해당 손님 실패 처리

---

## 9. 상태 머신(권장)

- `Idle` : 대기(아이템 선택 전)
- `ItemSelected` : 중앙로 이동, 스캔 가능
- `Scanning` : 바코드가 스캐너 위에 올라감(1초 타이머 진행)
- `Scanned` : POS 반영 + 스캔 완료 피드백
- `Bagging` : 비밀 봉투로 이동 처리
- `CheckoutAttempt` : 계산 버튼 클릭 후 정답 체크
- `Success` / `Mistake` / `Fail(Timeout)` : 결과 상태

---

## 10. 구현 체크리스트

- [ ] UI 레이아웃(상단 손님/중앙 POS+스캔/좌 봉투/우 장바구니)
- [ ] 만족도 게이지 시간 감소 + 오답 페널티
- [ ] 아이템 클릭 시 중앙 영역 좌/우로 이동
- [ ] 바코드 히트박스/검출 및 “1초 유지 스캔”
- [ ] 할인 스티커 상품(복수 바코드) + “최저 할인율만 정답”
- [ ] 중복 상품 스캔 시 수량 증가
- [ ] POS 리스트: 스캔된 것만 표시 + +/-
- [ ] 계산 버튼: 정답이면 통과 / 오답이면 만족도 급감 후 계속

---

## 11. 에셋/데이터 포맷 예시(권장)

- `Item`
  - `id`
  - `name`
  - `sprite`
  - `barcodes[]`
    - `type` : normal | discount
    - `discountRate` : 0.05 / 0.10 ... (discount일 때)
    - `rect` : 바코드 위치(스프라이트 좌표계)
- `CustomerOrder`
  - `requiredItems[]`
    - `itemId`
    - `qty`
    - `requiredBarcodeRule` (할인 상품이면 “minDiscountOnly”)

---

## 12. 참고 UX(권장 연출)

- 스캔 성공: “삑” 사운드 + 짧은 플래시
- 오답: 손님 표정 변화 + 만족도 급락 애니메이션
- 만족도 낮아질수록 손님 초조 연출(발 구르기, 팔짱 등)

---