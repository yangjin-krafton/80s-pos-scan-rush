/* ================================================================
   [4] CART DESKTOP — scattered card layout
   ================================================================ */

.cart-zone{
  background:#c0c0c0;
  border:2px solid;border-color:#dfdfdf #000 #000 #dfdfdf;
  box-shadow:inset 1px 1px 0 #fff, inset -1px -1px 0 #808080;
  margin:0 4px 3px;font-family:"MS Gothic","Arial Black",sans-serif;
  display:flex;flex-direction:column;min-height:0;overflow:hidden;
}
.cart-top{
  display:flex;justify-content:space-between;align-items:center;
  padding:2px 6px;background:#c0c0c0;flex-shrink:0;
}
.cart-title{
  font-size:12px;font-weight:bold;color:#000;
  font-family:"MS Gothic","Arial Black",sans-serif;letter-spacing:0.06em;
}
.cart-hint{
  font-size:10px;color:#808080;
  font-family:"MS Gothic","Arial Black",sans-serif;
  animation:hint-pulse 2s ease-in-out infinite;
}
@keyframes hint-pulse{0%,100%{opacity:0.4}50%{opacity:1}}

/* Desktop area where cards are scattered */
.cart-desktop{
  position:relative;flex:1;min-height:0;
  overflow:hidden;
  background:#008080;
  border:2px solid;border-color:#808080 #dfdfdf #dfdfdf #808080;
  box-shadow:inset 1px 1px 0 #000, inset -1px -1px 0 #fff;
  margin:0 3px 3px;
  /* tiled pattern like Win95 desktop */
  background-color:#008080;
  background-image:
    linear-gradient(45deg, rgba(0,0,0,0.04) 25%, transparent 25%),
    linear-gradient(-45deg, rgba(0,0,0,0.04) 25%, transparent 25%),
    linear-gradient(45deg, transparent 75%, rgba(0,0,0,0.04) 75%),
    linear-gradient(-45deg, transparent 75%, rgba(0,0,0,0.04) 75%);
  background-size:12px 12px;
  background-position:0 0, 0 6px, 6px -6px, -6px 0;
  --sat-deg:0;
}

/* ================================================================
   Skill Cooldown Timer Overlay (conic sweep from 12 o'clock)
   ================================================================ */
.cart-desktop::after{
  content:"";
  position:absolute;inset:0;
  pointer-events:none;
  z-index:0;
  border-radius:inherit;
  /* Dark wedge sweeps clockwise from 12 o'clock as satisfaction drains */
  background:conic-gradient(
    from 0deg at 50% 50%,
    rgba(0,0,0,0.38) 0deg,
    rgba(0,0,0,0.38) calc(var(--sat-deg) * 1deg),
    transparent       calc(var(--sat-deg) * 1deg),
    transparent       360deg
  );
  transition:background 0.2s linear;
}

/* ---- 10s warning: orange-tinted cooldown ---- */
.cart-desktop.cd-warn::after{
  background:conic-gradient(
    from 0deg at 50% 50%,
    rgba(180,100,0,0.40) 0deg,
    rgba(180,100,0,0.40) calc(var(--sat-deg) * 1deg),
    transparent           calc(var(--sat-deg) * 1deg),
    transparent           360deg
  );
  animation:cd-pulse-warn 0.8s ease-in-out infinite;
}
@keyframes cd-pulse-warn{
  0%,100%{opacity:1}
  50%    {opacity:0.6}
}

/* ---- 3s danger: red-tinted cooldown + fast pulse ---- */
.cart-desktop.cd-danger::after{
  background:conic-gradient(
    from 0deg at 50% 50%,
    rgba(200,0,0,0.45) 0deg,
    rgba(200,0,0,0.45) calc(var(--sat-deg) * 1deg),
    transparent         calc(var(--sat-deg) * 1deg),
    transparent         360deg
  );
  animation:cd-pulse-danger 0.4s ease-in-out infinite;
}
@keyframes cd-pulse-danger{
  0%,100%{opacity:1}
  50%    {opacity:0.5}
}

/* Scattered card */
.cart-card{
  position:absolute;
  width:64px;height:64px;
  background:#c0c0c0;
  border:2px solid;border-color:#dfdfdf #000 #000 #dfdfdf;
  box-shadow:inset 1px 1px 0 #fff, inset -1px -1px 0 #808080,
             2px 2px 4px rgba(0,0,0,0.3);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:1px;font-size:28px;cursor:pointer;
  transition:transform 0.15s, box-shadow 0.15s, border-color 0.15s;
  font-family:"MS Gothic","Arial Black",sans-serif;
  touch-action:none;
  -webkit-user-select:none;user-select:none;
}
.cart-card:active{
  border-color:#000 #dfdfdf #dfdfdf #000;
  box-shadow:inset 1px 1px 0 #808080, inset -1px -1px 0 #fff;
}
.cart-card.active{
  border-color:#000080;
  box-shadow:0 0 0 2px #000080, 0 0 8px rgba(0,0,128,0.4),
             inset 1px 1px 0 #fff, inset -1px -1px 0 #808080;
  background:linear-gradient(180deg,#d0d0ff,#c0c0c0);
  z-index:100 !important;
  transform:rotate(0deg) scale(1.08) !important;
}
.cart-card .cn{
  font-size:8px;color:#000;letter-spacing:0.02em;
  font-family:"MS Gothic","Arial Black",sans-serif;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  max-width:58px;text-align:center;
}
.cart-card .badge{
  position:absolute;top:-5px;right:-5px;
  min-width:18px;height:18px;border-radius:9px;
  background:#ff0000;color:#fff;font-size:10px;font-weight:900;
  display:flex;align-items:center;justify-content:center;
  border:2px solid #fff;box-shadow:1px 1px 0 #000;padding:0 2px;
  font-family:"MS Gothic","Arial Black",sans-serif;
}
.cart-card .sbadge{
  position:absolute;top:-5px;left:-5px;
  min-width:18px;height:18px;border-radius:9px;
  background:#ff0000;color:#fff;font-size:8px;font-weight:900;
  display:flex;align-items:center;justify-content:center;
  border:2px solid #fff;box-shadow:1px 1px 0 #000;padding:0 2px;
  font-family:"MS Gothic","Arial Black",sans-serif;
}
.cart-card .sbadge.promo{
  background:#0066cc;
  font-size:7px;
}

/* Card in .game (cross-zone drag / waiting in scan zone) */
.game > .cart-card{
  z-index:500;
}

/* Name → barcode when dragged out of cart */
.cart-card.in-game .cn{
  font-size:0 !important;color:transparent;
  width:48px;height:12px;max-width:none;
  background:repeating-linear-gradient(90deg,#000 0 1.5px,#fff 1.5px 3px);
  border:1px solid #808080;border-radius:1px;
}
.cart-card.in-game.is-sale .cn{
  background:repeating-linear-gradient(90deg,#800 0 1.5px,#fcc 1.5px 3px);
  border-color:#c00;
}

/* Fly-to-POS animation for card drag mode */
.cart-card.fly-to-pos{
  transition:left 0.3s ease-in, top 0.3s ease-in,
             transform 0.3s ease-in, opacity 0.3s ease-in;
  opacity:0;
  pointer-events:none;
}

/* ---- Meta: Damaged barcode card (Win95 corrupt file style) ---- */
.cart-card.is-damaged{
  border-color:#aa6060 #440000 #440000 #aa6060;
  /* Win95 corrupt bitmap: dithered noise + diagonal glitch stripes */
  background:
    repeating-linear-gradient(
      -45deg,
      transparent 0 3px,
      rgba(180,0,0,0.12) 3px 4px,
      transparent 4px 7px,
      rgba(0,0,0,0.06) 7px 8px
    ),
    repeating-linear-gradient(
      90deg,
      rgba(192,192,192,1) 0 2px,
      rgba(180,170,170,1) 2px 4px,
      rgba(200,190,190,1) 4px 6px,
      rgba(170,160,160,1) 6px 8px
    );
  background-color:#c0b0b0;
}
/* Corrupt file icon overlay — always visible even under finger */
.cart-card.is-damaged::before{
  content:"";
  position:absolute;inset:0;
  background:
    /* horizontal glitch bands */
    linear-gradient(180deg,
      transparent 0 15%,
      rgba(255,0,0,0.08) 15% 18%,
      transparent 18% 45%,
      rgba(0,0,0,0.06) 45% 48%,
      transparent 48% 70%,
      rgba(255,0,0,0.10) 70% 74%,
      transparent 74% 100%
    ),
    /* pixel-shift effect */
    repeating-linear-gradient(
      0deg,
      transparent 0 1px,
      rgba(0,0,0,0.03) 1px 2px
    );
  z-index:1;pointer-events:none;
  border-radius:inherit;
}
/* Red X mark in corner */
.cart-card.is-damaged::after{
  content:"\00D7";
  position:absolute;bottom:0;right:2px;
  font-size:18px;color:#cc0000;font-weight:900;
  font-family:'Courier New',monospace;
  z-index:3;pointer-events:none;line-height:1;
  text-shadow:0 0 2px #fff, 1px 1px 0 rgba(0,0,0,0.3);
}
.cart-card.is-damaged .cn{
  text-decoration:line-through;
  opacity:0.5;
  color:#660000;
}
/* Emoji gets slightly glitched look */
.cart-card.is-damaged > span:first-child{
  opacity:0.7;
  filter:contrast(0.8) saturate(0.5);
}

/* ---- Meta: Added item card (mid-round add) ---- */
.cart-card.is-added{
  border-color:#60aa60 #004400 #004400 #60aa60;
}
.cart-card.is-added::after{
  content:"ADD";
  position:absolute;top:-6px;right:-6px;
  background:#00cc00;color:#fff;
  font-size:7px;font-weight:900;
  padding:1px 3px;border:1px solid #006600;
  border-radius:2px;
  font-family:'Courier New',monospace;
  z-index:3;pointer-events:none;
}

/* ---- Meta: Cancelled item card (mid-round cancel) ---- */
.cart-card.is-cancelled{
  opacity:0.45;
  pointer-events:none;
  border-color:#aa0000 #440000 #440000 #aa0000;
}
.cart-card.is-cancelled::after{
  content:"CANCEL" !important;
  position:absolute;top:50%;left:50%;
  transform:translate(-50%,-50%) rotate(-15deg);
  background:#cc0000;color:#fff;
  font-size:8px;font-weight:900;
  padding:2px 6px;border:1px solid #660000;
  border-radius:2px;
  font-family:'Courier New',monospace;
  z-index:10;pointer-events:none;
  white-space:nowrap;
  /* override damaged ::after */
  bottom:auto;right:auto;text-shadow:none;
}
