/* ================================================================
   [2] CUSTOMER SCENE
   ================================================================ */

.customer-scene{
  position:relative;height:88px;margin:2px 0 0;overflow:hidden;
  image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;
  border-bottom:2px solid #000;
}
.scene-bg{
  position:absolute;inset:0;
  background:
    linear-gradient(180deg,
      #3a2518 0,#3a2518 2px,transparent 2px,transparent 18px,
      #2a1a10 18px,#2a1a10 20px,transparent 20px,transparent 100%),
    repeating-linear-gradient(90deg,#6b4c35 0,#6b4c35 30px,#5a3f2c 30px,#5a3f2c 32px),
    #5e4230;
  background-size:100% 100%, 32px 18px, 100% 100%;
}
.scene-bg::before{
  content:"";position:absolute;top:3px;left:8px;right:8px;height:14px;
  background:linear-gradient(90deg,
    #e02020 0,#e02020 8px,transparent 8px,transparent 14px,
    #20a020 14px,#20a020 22px,transparent 22px,transparent 28px,
    #2060e0 28px,#2060e0 36px,transparent 36px,transparent 44px,
    #e0c020 44px,#e0c020 52px,transparent 52px,transparent 58px,
    #e06020 58px,#e06020 66px,transparent 66px,transparent 74px,
    #c020c0 74px,#c020c0 82px,transparent 82px,transparent 90px,
    #20c0c0 90px,#20c0c0 98px,transparent 98px,transparent 106px,
    #e02020 106px,#e02020 114px,transparent 114px,transparent 100%);
  background-size:120px 10px;background-repeat:repeat-x;
  background-position:0 2px;image-rendering:pixelated;
}
.scene-floor{
  position:absolute;bottom:0;left:0;right:0;height:18px;
  background:repeating-conic-gradient(#b89878 0% 25%,#a08868 0% 50%) 0 0 / 12px 12px;
  border-top:2px solid #3a2518;
}
.scene-hud{
  position:absolute;top:0;left:0;right:0;
  display:flex;justify-content:space-between;align-items:flex-start;
  padding:3px 6px;z-index:5;pointer-events:none;
}
.hud-left{display:flex;flex-direction:column;gap:1px}
.hud-name{
  font-family:'Courier New',monospace;font-size:10px;font-weight:bold;color:#fff;
  text-shadow:1px 1px 0 #000,-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000;
  letter-spacing:0.5px;
}
.hud-right{
  font-family:'Courier New',monospace;font-size:9px;font-weight:bold;color:#ffe040;
  text-shadow:1px 1px 0 #000,-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000;
}

/* Current pixel character */
.px-current{
  position:absolute;left:20px;bottom:18px;
  display:flex;flex-direction:column;align-items:center;z-index:3;
  animation:px-idle 0.8s steps(1) infinite;
}
@keyframes px-idle{0%,100%{transform:translateY(0)}50%{transform:translateY(-2px)}}
.px-head{font-size:26px;line-height:1;filter:drop-shadow(1px 1px 0 #000)}
.px-body{
  width:20px;height:14px;background:var(--npc-body,#3060d0);border:2px solid #000;border-top:none;
  position:relative;image-rendering:pixelated;
}
.px-body::before,.px-body::after{
  content:"";position:absolute;top:1px;width:4px;height:8px;
  background:var(--npc-body,#3060d0);border:1px solid #000;
}
.px-body::before{left:-5px}
.px-body::after{right:-5px}
.px-legs{display:flex;gap:4px}
.px-leg{width:6px;height:6px;background:var(--npc-legs,#204080);border:1px solid #000}

/* Queue characters */
.px-queue{
  position:absolute;right:6px;bottom:18px;
  display:flex;flex-direction:row-reverse;gap:4px;z-index:2;
}
.px-qchar{display:flex;flex-direction:column;align-items:center}
.px-qchar .qc-head{font-size:16px;line-height:1;filter:drop-shadow(1px 1px 0 #000)}
.px-qchar .qc-body{width:14px;height:10px;border:1px solid #000;border-top:none}
.px-qchar .qc-legs{display:flex;gap:2px}
.px-qchar .qc-leg{width:4px;height:4px;border:1px solid #000}
.px-qchar:nth-child(1) .qc-body{background:#d03030}
.px-qchar:nth-child(1) .qc-leg{background:#a02020}
.px-qchar:nth-child(2) .qc-body{background:#30a030}
.px-qchar:nth-child(2) .qc-leg{background:#208020}
.px-qchar:nth-child(3) .qc-body{background:#d0a020}
.px-qchar:nth-child(3) .qc-leg{background:#a08018}
.px-qchar:nth-child(4) .qc-body{background:#a030c0}
.px-qchar:nth-child(4) .qc-leg{background:#8020a0}
.px-qchar:nth-child(5) .qc-body{background:#30a0c0}
.px-qchar:nth-child(5) .qc-leg{background:#2080a0}
.px-qchar:nth-child(odd){animation:q-sway 1s steps(1) infinite}
.px-qchar:nth-child(even){animation:q-sway 1s steps(1) 0.5s infinite}
@keyframes q-sway{0%,100%{transform:translateY(0)}50%{transform:translateY(-1px)}}
.px-qchar:nth-child(4){opacity:0.6}
.px-qchar:nth-child(5){opacity:0.35}

/* Counter/register */
.px-counter{
  position:absolute;left:60px;bottom:18px;width:24px;height:22px;
  background:#808080;border:2px solid #000;z-index:2;image-rendering:pixelated;
}
.px-counter::before{
  content:"";position:absolute;top:2px;left:3px;width:16px;height:8px;
  background:#40e040;border:1px solid #000;
}
.px-counter::after{
  content:"";position:absolute;bottom:2px;left:6px;right:6px;height:3px;
  background:#404040;border:1px solid #222;
}

/* ================================================================
   Customer state machine animations
   ================================================================ */

/* Offscreen right (initial / between rounds) */
.px-current.offscreen-right{transform:translateX(320px);animation:none;}

/* Entering: move to counter (0.6s) */
.px-current.is-moving{animation:move-to-counter 0.6s steps(8) forwards;}
@keyframes move-to-counter{
  0%{transform:translateX(320px)}
  50%{transform:translateX(160px) translateY(-2px)}
  100%{transform:translateX(0)}
}

/* Happy feedback bounce */
.px-current.is-happy{animation:happy-bounce 0.3s steps(1) 3;}
@keyframes happy-bounce{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-3px)}
}

/* Angry feedback shake */
.px-current.is-angry{animation:angry-shake 0.1s steps(1) 4;}
@keyframes angry-shake{
  0%,100%{transform:translateX(0)}
  25%{transform:translateX(-3px)}
  75%{transform:translateX(3px)}
}

/* Leave left (happy exit) */
.px-current.leave-left{animation:leave-left 0.6s steps(6) forwards;}
@keyframes leave-left{
  0%{transform:translateX(0);opacity:1}
  100%{transform:translateX(-100px);opacity:0}
}

/* Leave right (angry exit) */
.px-current.leave-right{animation:leave-right 0.4s steps(4) forwards;}
@keyframes leave-right{
  0%{transform:translateX(0);opacity:1}
  100%{transform:translateX(340px);opacity:0}
}

/* Feedback container */
.px-feedback{
  position:absolute;left:20px;bottom:60px;
  pointer-events:none;z-index:6;opacity:0;
}
.px-feedback.active{opacity:1;}

/* Heart effect */
.fb-heart{
  position:absolute;font-size:12px;
  animation:heart-float 1.0s ease-out forwards;
  color:#e00040;
}
@keyframes heart-float{
  0%{opacity:1;transform:translateY(0) scale(1)}
  60%{opacity:1;transform:translateY(-14px) scale(1.1)}
  100%{opacity:0;transform:translateY(-20px) scale(0.8)}
}

/* Angry effect */
.fb-angry{
  font-family:'Courier New';font-size:14px;font-weight:bold;
  color:#c00;animation:angry-pop 0.6s forwards;
}
@keyframes angry-pop{
  0%{opacity:0;transform:scale(0.5)}
  20%{opacity:1;transform:scale(1.3)}
  40%,100%{opacity:1;transform:scale(1)}
}

/* Queue departing character */
.px-qchar.departing{
  animation:q-depart 0.4s steps(4) forwards;
}
@keyframes q-depart{
  0%{transform:translateX(0);opacity:1}
  100%{transform:translateX(-30px);opacity:0}
}
