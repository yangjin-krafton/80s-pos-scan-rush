# 손님 동선 + 결과 피드백 연출 설계

목표: **라운드=레벨** 구조에서 손님이 난이도 곡선에 맞춰 등장하도록 설계하고, 손님이 실제 줄을 서고 계산대에 접근했다가 떠나는 흐름을 시각적으로 명확히 보여주며, 만족/불만 결과를 직관적인 피드백(하트/이모지/퇴장 연출)로 전달한다.

## 1) 화면 연출 흐름(요약)
1. **입장/줄서기**: 오른쪽 `px-queue`에 대기 손님 표시.
2. **호출**: 다음 손님이 계산대로 이동(좌측 `px-current`로 이동 애니메이션).
3. **계산 진행**: 만족도 변동에 따라 표정/말풍선/하트 표시 갱신.
4. **결과 피드백**:
   - 만족: 하트/스탬프/“THANK YOU” 이펙트 + 살짝 튀어나가며 퇴장.
   - 불만: 붉은 스파크/“!!” 이펙트 + 급히 떠나는 퇴장.
5. **다음 손님 호출**: 줄에서 한 명 줄어든 상태 반영.

## 2) 레벨(라운드) 기반 난이도 곡선
라운드는 게임의 레벨이며, 레벨이 올라갈수록 손님 유형/속도/아이템 수가 증가한다.

권장 난이도 축(라운드별로 점진 상승):
- 손님 유형: `kind` → `picky` → `rushed`
- 만족도 감소 속도(`drainRate`): 2.0 → 5.0
- 아이템 개수/종류: 적음 → 많음 (스캔 부담 증가)
- 실수 허용 폭: 감소(미스 시 페널티 상승)

레벨별 연출 포인트:
- 초반: 말풍선/표정 변화 중심
- 중반: 피드백 이펙트(하트/!!), 이동 속도 가속
- 후반: 불만 퇴장 빈도 증가, 대기열 압박 강화

## 3) 상태 머신 설계(게임 로직)
권장 상태:
- `queue_enter` → `queue_wait` → `move_to_counter` → `serving` → `feedback` → `leave` → 다음 라운드

필요 이벤트:
- `roundStart`: 줄 렌더
- `customerSummon`: 다음 손님 이동 시작
- `customerArrive`: 계산대 도착
- `roundClear`: 만족 피드백
- `scanFail` 또는 만족도 임계치 미달: 불만 피드백
- `customerLeave`: 퇴장 완료

## 4) DOM 구성(추가 제안)
현재 구조를 유지하되 최소 추가:
- `.px-current` 내부에 **피드백 배지 레이어** 추가
  - 예: `<div class="px-feedback"></div>`
- `.px-queue`의 각 손님에 **이동 애니메이션 클래스** 토글

## 5) 연출 세부(UX)
### 5-1. 만족(Positive)
- 이펙트: 하트 2~3개가 위로 살짝 떠오르고 사라짐
- 텍스트: `THANK YOU!` 또는 `고마워요!`
- 이동: `leave` 단계에서 좌측 밖으로 천천히 이동

### 5-2. 불만(Negative)
- 이펙트: 붉은 `!!` + 짧은 흔들림
- 텍스트: `너무 느려!` 고정
- 이동: `leave` 단계에서 빠르게 우측 밖으로 이동

## 6) CSS 애니메이션 가이드
권장 클래스/키프레임:
- `.is-moving` (queue → counter 이동)
- `.is-happy` (만족 피드백)
- `.is-angry` (불만 피드백)
- `.is-leaving` (퇴장)

키프레임 예시(설계 개념):
- `@keyframes move-to-counter` : right→left translate
- `@keyframes feedback-pop` : scale + opacity
- `@keyframes leave-left` / `leave-right`

## 7) 데이터 소스
NPC(손님) 설정은 아래 파일을 사용한다.
- `src/data/npcs.json`

상품 정보는 아래 파일을 사용한다.
- `src/data/products.csv`

## 8) JS 처리 포인트
`src/js/ui.js`에 추가될 흐름(의사코드):
```
Bus.on('customerSummon', () => UI.setCustomerMotion('move_to_counter'))
Bus.on('customerArrive', () => UI.setCustomerMotion('serving'))
Bus.on('roundClear', () => UI.playFeedback('happy'))
Bus.on('scanFail', () => UI.playFeedback('angry'))
Bus.on('customerLeave', () => UI.setCustomerMotion('leave'))
```

권장 최적화:
- 만족도/표정/말풍선 업데이트는 **값이 변한 경우**만 갱신
- 이펙트 DOM은 재사용(생성/삭제 반복 최소화)

## 9) 구현 우선순위(권장)
1. **상태 머신 이벤트 추가** (roundStart → leave 순서 고정)
2. **CSS 이동/퇴장 애니메이션**
3. **피드백 배지/하트 이펙트**
4. **불만 급퇴장 연출**

## 10) 검증 체크리스트
- 줄 인원 수가 라운드 진행에 따라 정상 감소하는가
- 이동 시작/도착 시점이 로직과 일치하는가
- 레벨(라운드) 상승에 따라 `drainRate/아이템 수/손님 유형`이 의도대로 증가하는가
- 만족/불만 상태에서 올바른 이펙트가 1회만 실행되는가
- 빠른 라운드 전환 시 애니메이션이 꼬이지 않는가
